---
version: "3"

dotenv: ['.env']

tasks:
  check:
    cmds:
      - golangci-lint run --config ../.golangci.yml --timeout=5m

  air:
    cmds:
      - docker compose -f compose.local.air.yml up

  run:
    cmds:
      - go run .

  test:
    cmds:
      - docker compose -f compose.test.yml up -d --wait
      - go test -coverprofile=coverage.out ./... -tags=medium --count=1
      - gcov2lcov -infile=coverage.out -outfile=coverage.lcov
    env:
      APP_ENV: test
      TEST_MYSQL_HOST: localhost
      TEST_MYSQL_PORT: 3307
      TEST_MYSQL_USERNAME: username
      TEST_MYSQL_PASSWORD: password
      TEST_MYSQL_DATABASE: test
  clear-test:
    cmds:
      - docker compose -f compose.test.yml down
